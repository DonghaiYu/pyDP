# -*- coding: utf8 -*-
# @Time    : 2016/11/30 13:34
# @Author  : Dylan
# @Site    : 
# @File    : pyDP.py
# @Software: PyCharm Community Edition


"""
This is an implementation of Douglas-Peucker Algorithm, which can be used for trajectory compression.
When there are enough points in a trajectory, this algorithm can find the key point in the trajectory.
This tool support high dimension points.
depend on: numpy, math
"""
import math
import numpy as np


EUCLIDIAN_DISTANCE = 1
MANHATTAN_DISTANCE = 2


def distance(a, b, method):
    """Distance calculation between two points.
    Args:
        a: one of the two points.
        b: another point of the two points.
        method: distance calculation method.
    Returns:
        The distance between a and b based on method.
    :param a: point a
    :param b: point b
    :param method: distance calculation method
    :return: distance between a and b.
    """
    dist = float('inf')
    if len(a) != len(b):
        print("different size between A and B")
        return dist
    a_f = []
    b_f = []
    for i in range(0, len(a)):
        try:
            a_f.append(float(a[i]))
            b_f.append(float(b[i]))
        except TypeError as error:
            print("can't trans the points to float list")
            break
    if method == EUCLIDIAN_DISTANCE:
        ab_sum = 0
        for i in range(len(a_f)):
            ab_sum += pow((a_f[i] - b_f[i]), 2)
        dist = math.sqrt(ab_sum)
    elif method == MANHATTAN_DISTANCE:
        ab_sum = 0
        for i in range(len(a_f)):
            ab_sum += abs(a_f[i] - b_f[i])
        dist = ab_sum
    return dist


def distance_point2line(a, b, c):
    """Calculate the distance from a point to a line, when the line is decided by two points.
    the equation: |vector(ac)Ã—vector(bc)|/vector(ab), a, b decide a line, c is the target point.
    :param a: the first line point
    :param b: the second line point
    :param c: the target point
    :return: the distance to line which is decided by point a and point b
    """
    if len(a) != len(b) or len(a) != len(c):
        print("there are different size between the points!")
        return
    a_f = np.array(a, dtype="float32")
    b_f = np.array(b, dtype="float32")
    c_f = np.array(c, dtype="float32")

    ab = a_f - b_f
    bc = b_f - c_f
    ac = a_f - c_f
    return sum((ac * bc)**2)**0.5 / sum(ab**2)**0.5


def trajectory_compression(raw_trajectory, threshold):
    """
    :param raw_trajectory: the trajectory data, exp: [[x1, y1], [x2, y2], ... , [xn, yn]]
    :param threshold: distance threshold
    :return: compressed trajectory
    """
    if len(raw_trajectory) < 2:
        print("less than 2 points in your trajectory!")
        return
    try:
        threshold = float(threshold)
    except:
        print("can`t trans the threshold(type%s) to float" % type(threshold))
        return
    key_arr = [0 for i in range(len(raw_trajectory))]
    key_arr[0] = 1
    key_arr[len(raw_trajectory)-1] = 1
    find_far_point(raw_trajectory, 0, len(raw_trajectory)-1, threshold, key_arr)
    key_points = []
    for i in range(len(key_arr)):
        if key_arr[i] == 1:
            key_points.append(raw_trajectory[i])
    return key_points


def find_far_point(arr, i, j, threshold, flag_arr):
    """
    This function is used for finding the farthest points (to line (arr[i], arr[j])) in sub trajectory arr(i, j),
    it is recursive until there are no more points's distance is larger than threshold to the line. if a point is not
    ignored in the trajectory, it's index in flag_arr will be set as 1, otherwise 0.
    :param arr: trajectory data
    :param i: start index
    :param j: end index
    :param threshold: distance threshold
    :param flag_arr: the flag array of useful or ignore for the trajectory points(0:ignore, 1:useful)
    :return: none, but change the flag_arr
    """
    if i > len(arr) or j > len(arr):
        print("index out of range")
        return
    max_distance = float(0)
    flag = -1
    for k in range(i + 1, j):
        d = distance_point2line(arr[i], arr[j], arr[k])
        print(d)
        if d > max_distance:
            max_distance = d
            flag = k
    if max_distance > threshold:
        flag_arr[flag] = 1
        find_far_point(arr, i, flag, threshold, flag_arr)
        find_far_point(arr, flag, j, threshold, flag_arr)

arrs = [[116.382433, 39.879020],[116.382523, 39.879123],[116.382373, 39.878888],[116.382373, 39.878888],[116.382423, 39.878871],[116.382433, 39.878906],[116.382223, 39.878787],[116.382273, 39.878771],[116.382273, 39.878771],[116.382403, 39.878822],[116.382373, 39.878772],[116.382403, 39.878858],[116.382373, 39.878788],[116.382373, 39.878788],[116.382363, 39.878871],[116.382337, 39.878871],[116.382337, 39.878921],[116.382393, 39.878858],[116.382393, 39.878858],[116.382473, 39.878921],[116.382433, 39.879038],[116.382433, 39.879005],[116.382493, 39.878988],[116.382493, 39.878988],[116.382473, 39.878871],[116.382459, 39.878988],[116.382493, 39.878954],[116.382459, 39.878906],[116.382459, 39.878906],[116.382558, 39.878838],[116.382643, 39.878570],[116.382589, 39.878505],[116.382423, 39.878808],[116.382423, 39.878808],[116.382403, 39.878888],[116.382459, 39.878988],[116.382473, 39.878921],[116.382573, 39.879088],[116.382573, 39.879088],[116.382473, 39.878970],[116.382393, 39.878906],[116.382423, 39.878906],[116.382373, 39.878888],[116.382373, 39.878888],[116.382223, 39.878752],[116.382303, 39.878772],[116.382403, 39.878888],[116.382459, 39.878921],[116.382459, 39.878921],[116.382433, 39.878871],[116.382373, 39.878822],[116.382423, 39.878871],[116.382337, 39.878871],[116.382337, 39.878858],[116.382253, 39.878722],[116.382273, 39.878722],[116.382393, 39.878753],[116.382503, 39.878988],[116.382503, 39.878988],[116.382523, 39.878938],[116.382543, 39.879020],[116.382573, 39.879038],[116.382558, 39.878971],[116.382558, 39.878971],[116.382573, 39.878921],[116.382603, 39.878988],[116.382573, 39.878971],[116.382523, 39.878988],[116.382523, 39.878988],[116.382503, 39.878921],[116.382523, 39.878938],[116.382523, 39.878822],[116.382373, 39.878753],[116.382373, 39.878753],[116.382503, 39.878921],[116.382543, 39.878673],[116.382543, 39.878738],[116.382589, 39.878871],[116.382589, 39.878871],[116.382603, 39.878971],[116.382603, 39.878938],[116.382573, 39.878971],[116.382573, 39.878704],[116.382573, 39.878704],[116.382643, 39.878673],[116.382543, 39.878738],[116.382493, 39.878753],[116.382473, 39.878970],[116.382473, 39.878970],[116.382723, 39.878654],[116.382853, 39.878555],[116.382723, 39.878618],[116.382723, 39.878638],[116.382723, 39.878638],[116.382657, 39.878753],[116.382573, 39.878888],[116.382523, 39.878921],[116.382558, 39.878788],[116.382558, 39.878788],[116.382459, 39.878871],[116.382473, 39.878888],[116.382573, 39.878906],[116.382573, 39.878871],[116.382573, 39.878871],[116.382723, 39.878772],[116.382589, 39.878808],[116.382543, 39.878858],[116.382423, 39.878938],[116.382423, 39.878938],[116.382459, 39.878938],[116.382403, 39.878970],[116.382433, 39.878970],[116.382473, 39.879005],[116.382473, 39.879005],[116.382403, 39.878906],[116.382433, 39.878921],[116.382573, 39.878888],[116.382543, 39.878788],[116.382543, 39.878788],[116.382558, 39.878838],[116.382603, 39.878888],[116.382573, 39.878888],[116.382433, 39.878906],[116.382433, 39.878906],[116.382473, 39.878954],[116.382459, 39.878921],[116.382403, 39.878970],[116.382423, 39.878970],[116.382423, 39.878970],[116.382643, 39.878822],[116.382688, 39.878772],[116.382643, 39.878753],[116.382589, 39.878788],[116.382589, 39.878788],[116.382503, 39.878772],[116.382473, 39.878772],[116.382493, 39.878838],[116.382503, 39.878871],[116.382503, 39.878871],[116.382503, 39.878822],[116.382473, 39.878772],[116.382473, 39.878822],[116.382643, 39.878673],[116.382643, 39.878673],[116.382503, 39.878753],[116.382493, 39.878753],[116.382493, 39.878688],[116.382433, 39.878788],[116.382433, 39.878788],[116.382459, 39.878738],[116.382503, 39.878838],[116.382363, 39.878858],[116.382363, 39.878858],[116.382363, 39.878858],[116.382337, 39.878838],[116.382373, 39.878838],[116.382303, 39.878906],[116.382423, 39.878858],[116.382423, 39.878858],[116.382363, 39.878838],[116.382273, 39.878937],[116.382393, 39.878838],[116.382744, 39.878588],[116.382744, 39.878588],[116.382589, 39.878753],[116.382493, 39.878704],[116.382373, 39.878838],[116.382459, 39.878938],[116.382459, 39.878938],[116.382459, 39.878808],[116.382433, 39.878838],[116.382393, 39.878822],[116.382337, 39.878788],[116.382337, 39.878788],[116.382323, 39.878871],[116.382293, 39.878888],[116.382323, 39.878858],[116.382423, 39.878858],[116.382423, 39.878858],[116.382459, 39.878921],[116.382423, 39.878888],[116.382459, 39.878921],[116.382503, 39.879038],[116.382503, 39.879038],[116.382459, 39.878888],[116.382493, 39.879038],[116.382523, 39.878921],[116.382363, 39.879123],[116.382363, 39.879123],[116.382293, 39.878888],[116.382207, 39.878787],[116.382273, 39.878771],[116.382393, 39.878988],[116.382393, 39.878988],[116.382303, 39.878921],[116.382363, 39.878808],[116.382423, 39.878838],[116.382744, 39.878673],[116.382744, 39.878673],[116.382558, 39.878955],[116.382523, 39.879038],[116.382523, 39.878970],[116.382493, 39.878954],[116.382493, 39.878954],[116.382459, 39.879054],[116.382493, 39.879038],[116.382523, 39.879005],[116.382473, 39.878888],[116.382473, 39.878888],[116.382503, 39.878921],[116.382573, 39.878822],[116.382723, 39.878638],[116.382589, 39.878871],[116.382589, 39.878871],[116.382503, 39.878938],[116.382543, 39.878938],[116.382473, 39.878954],[116.382543, 39.879054],[116.382523, 39.879054],[116.382558, 39.878921],[116.382558, 39.878871],[116.382558, 39.878838],[116.383054, 39.878486],[116.383054, 39.878486],[116.382703, 39.878723],[116.382623, 39.878838],[116.382543, 39.878938],[116.382589, 39.878921],[116.382589, 39.878921],[116.382473, 39.879020],[116.382493, 39.879038],[116.382493, 39.879020],[116.382543, 39.878988],[116.382543, 39.878988],[116.382473, 39.879138],[116.382473, 39.879123],[116.382523, 39.879020],[116.382623, 39.878971],[116.382623, 39.878971],[116.382558, 39.878921],[116.382558, 39.878921],[116.382573, 39.878955],[116.382503, 39.878988],[116.382503, 39.878988],[116.382473, 39.879020],[116.382493, 39.879020],[116.382503, 39.879038],[116.382473, 39.879005],[116.382473, 39.879005],[116.382473, 39.878988],[116.382493, 39.879104],[116.382493, 39.879138],[116.382373, 39.879005],[116.382373, 39.878988],[116.382393, 39.879054],[116.382433, 39.878888],[116.382373, 39.878808],[116.382473, 39.878970],[116.382473, 39.878970],[116.382558, 39.878938],[116.382573, 39.879005],[116.382543, 39.878988],[116.382543, 39.879054],[116.382543, 39.879054],[116.382493, 39.879054],[116.382523, 39.879054],[116.382473, 39.879054],[116.382543, 39.878971],[116.382543, 39.878955],[116.382703, 39.878921],[116.382603, 39.878938],[116.382643, 39.878888],[116.382623, 39.878808],[116.382623, 39.878808],[116.382754, 39.878822],[116.382674, 39.878772],[116.382974, 39.878788],[116.383108, 39.878753],[116.383108, 39.878753],[116.382884, 39.878772],[116.382723, 39.878753],[116.382459, 39.878788],[116.382423, 39.878888],[116.382423, 39.878888],[116.382403, 39.878788],[116.382643, 39.878638],[116.382543, 39.878772],[116.382603, 39.878788],[116.382603, 39.878788],[116.382363, 39.878871],[116.382403, 39.878822],[116.382459, 39.878871],[116.382423, 39.878808],[116.382423, 39.878808],[116.382459, 39.878858],[116.382433, 39.878921],[116.382393, 39.878871],[116.382403, 39.878938],[116.382403, 39.878938],[116.382473, 39.878921],[116.382493, 39.878938],[116.382393, 39.879005],[116.382373, 39.878858],[116.382373, 39.878858],[116.382459, 39.878871],[116.382433, 39.878808],[116.382293, 39.878871],[116.382303, 39.878938],[116.382303, 39.878938],[116.382303, 39.878970],[116.382303, 39.878888],[116.382293, 39.878871],[116.382303, 39.878838],[116.382303, 39.878838],[116.382323, 39.878858],[116.382363, 39.878888],[116.382403, 39.878888],[116.382403, 39.878906],[116.382403, 39.878906],[116.382503, 39.878938],[116.382430, 39.878893],[116.382493, 39.878906],[116.382433, 39.878954],[116.382493, 39.878970],[116.382493, 39.878970],[116.378818, 39.878700],[116.375213, 39.878561],[116.373795, 39.877460],[116.373631, 39.877327],[116.373631, 39.877327],[116.374111, 39.876344],[116.374131, 39.875998],[116.374043, 39.875901],[116.374146, 39.876048],[116.374146, 39.875998],[116.374146, 39.875998],[116.373883, 39.875889],[116.374191, 39.875998],[116.374161, 39.876012],[116.374245, 39.873311],[116.360716, 39.868674],[116.360937, 39.868708],[116.336734, 39.868097],[116.335912, 39.868062],[116.336814, 39.867864],[116.341014, 39.869288],[116.341014, 39.869288],[116.340893, 39.868322],[116.340873, 39.868302],[116.340893, 39.868288],[116.340903, 39.868296],[116.340873, 39.868338],[116.340873, 39.868322],[116.340857, 39.868286],[116.340857, 39.868286],[116.335952, 39.868062],[116.337155, 39.867980],[116.338037, 39.868000],[116.339871, 39.867985],[116.339871, 39.867985],[116.351481, 39.868075],[116.362460, 39.868826],[116.373189, 39.870093],[116.387828, 39.868209],[116.387828, 39.868042],[116.386565, 39.865599],[116.386565, 39.865599],[116.386352, 39.865705],[116.379852, 39.866817],[116.379628, 39.866884],[116.379287, 39.866817],[116.378967, 39.866118],[116.378967, 39.866118],[116.379768, 39.865754],[116.384524, 39.865906],[116.385645, 39.865640],[116.386676, 39.865325],[116.386676, 39.865325],[116.387908, 39.869808],[116.387978, 39.872608],[116.387998, 39.872592],[116.387998, 39.872592],[116.387998, 39.872592],[116.387983, 39.872599],[116.387983, 39.872599],[116.387998, 39.872608],[116.387699, 39.874859],[116.387549, 39.877709],[116.387429, 39.880742],[116.387429, 39.880742],[116.387409, 39.881492],[116.387229, 39.881478],[116.387363, 39.882958],[116.384927, 39.885591],[116.384927, 39.885591],[116.384847, 39.887291],[116.384813, 39.887790],[116.384462, 39.889440],[116.374500, 39.893114],[116.374500, 39.893114],[116.374544, 39.894729],[116.374534, 39.896112],[116.374514, 39.896179],[116.374515, 39.897696],[116.374515, 39.897696],[116.374545, 39.898210],[116.374515, 39.898829],[116.374501, 39.898899],[116.374235, 39.903929],[116.374235, 39.903929],[116.374195, 39.906629],[116.373966, 39.911596],[116.373866, 39.913729],[116.369308, 39.914341],[116.369308, 39.914341],[116.365822, 39.914134],[116.363963, 39.914131],[116.363998, 39.914115],[116.362997, 39.914913],[116.362997, 39.914913],[116.362883, 39.914772],[116.363217, 39.915184],[116.363054, 39.915110],[116.363054, 39.915110],[116.361043, 39.915392],[116.364701, 39.918882],[116.365066, 39.923749],[116.365066, 39.923749],[116.368324, 39.935173],[116.369262, 39.943059],[116.370295, 39.948076],[116.371366, 39.948278],[116.371366, 39.948278],[116.383454, 39.948707],[116.389106, 39.948748],[116.390371, 39.948764],[116.390427, 39.948733],[116.390427, 39.948733],[116.392072, 39.948833],[116.392072, 39.948820],[116.392779, 39.948800],[116.392878, 39.948765],[116.392878, 39.948765],[116.401428, 39.948804],[116.410219, 39.948922],[116.412033, 39.949055],[116.419754, 39.949353],[116.419754, 39.949353],[116.436111, 39.949456],[116.447554, 39.951506],[116.456569, 39.959638],[116.477491, 39.978407],[116.477491, 39.978407],[116.489395, 39.989208],[116.499877, 39.998726],[116.510253, 40.008079],[116.537258, 40.022721],[116.537258, 40.022721],[116.572093, 40.034316],[116.590123, 40.035499],[116.603181, 40.031724],[116.610640, 40.031546],[116.610640, 40.031546],[116.617148, 40.044384],[116.619531, 40.053434],[116.617494, 40.054404],[116.617494, 40.054404],[116.616250, 40.054567],[116.614926, 40.053615],[116.615410, 40.047098],[116.615410, 40.047098],[116.600803, 40.049827],[116.599103, 40.052480],[116.594354, 40.054447],[116.594348, 40.054451],[116.594348, 40.054451],[116.593584, 40.057216],[116.593584, 40.057216],[116.591126, 40.061233],[116.591497, 40.059154],[116.591497, 40.059154],[116.591497, 40.059154],[116.591466, 40.059099],[116.591705, 40.056633],[116.590172, 40.057015],[116.590172, 40.057015],[116.589257, 40.058118],[116.588957, 40.058465],[116.588441, 40.059183],[116.588427, 40.059231],[116.588427, 40.059231],[116.588178, 40.059401],[116.588008, 40.059551],[116.586059, 40.060669],[116.570329, 40.062171],[116.570329, 40.062171],[116.561297, 40.063600],[116.559866, 40.063172],[116.558839, 40.063470],[116.558968, 40.063540],[116.558968, 40.063540],[116.559102, 40.063640],[116.560918, 40.062886],[116.561147, 40.063552],[116.557329, 40.064398],[116.557329, 40.064398],[116.557290, 40.064399],[116.556359, 40.064030],[116.556109, 40.063863],[116.556159, 40.063877],[116.556089, 40.063812],[116.556019, 40.063863],[116.556019, 40.063863],[116.556045, 40.063845],[116.556079, 40.063764],[116.556009, 40.063778],[116.556045, 40.063778],[116.556045, 40.063778],[116.556045, 40.063845],[116.556129, 40.063764],[116.556060, 40.063774],[116.556129, 40.063796],[116.555998, 40.063834],[116.562125, 40.063204],[116.562125, 40.063204],[116.562772, 40.052762],[116.562562, 40.049716],[116.558202, 40.045510],[116.560646, 40.044686],[116.560646, 40.044686],[116.560227, 40.045302],[116.560130, 40.045400],[116.559907, 40.045454],[116.559907, 40.045454],[116.560247, 40.045371],[116.561344, 40.043969],[116.568979, 40.043006],[116.568979, 40.043006],[116.578195, 40.042259],[116.572322, 40.036316],[116.568862, 40.034637],[116.565295, 40.032910],[116.565235, 40.032876],[116.556504, 40.029310],[116.552996, 40.028233],[116.549053, 40.026958],[116.541993, 40.024410],[116.541923, 40.024391],[116.533819, 40.021546],[116.527889, 40.019462],[116.523541, 40.017909],[116.515534, 40.013066],[116.515534, 40.013066],[116.508375, 40.006636],[116.504475, 40.003046],[116.500509, 39.999492],[116.490610, 39.990521],[116.490610, 39.990521],[116.485045, 39.985436],[116.480062, 39.980968],[116.472388, 39.974037],[116.454438, 39.957860],[116.454438, 39.957860],[116.437337, 39.949637],[116.432501, 39.949425],[116.433642, 39.942858],[116.433977, 39.935324],[116.433977, 39.935324],[116.434341, 39.924974],[116.434604, 39.917923],[116.435561, 39.910838],[116.442677, 39.898657],[116.442677, 39.898657],[116.445997, 39.880403],[116.443751, 39.871774],[116.433269, 39.871005],[116.411308, 39.872235],[116.411308, 39.872235],[116.387177, 39.871326],[116.387678, 39.871592],[116.387613, 39.865509],[116.379300, 39.866069],[116.379300, 39.866069],[116.379217, 39.865933],[116.379300, 39.866069],[116.379217, 39.865933],[116.383853, 39.865856],[116.387097, 39.865225],[116.387744, 39.869842],[116.387660, 39.875038],[116.386978, 39.879024],[116.386978, 39.879024],[116.379619, 39.878868],[116.376485, 39.878746],[116.373160, 39.878606],[116.370856, 39.881489],[116.370856, 39.881489],[116.367381, 39.885803],[116.368088, 39.889070],[116.368033, 39.888905],[116.374212, 39.885046],[116.374212, 39.885046],[116.374148, 39.888162],[116.374630, 39.893846],[116.374966, 39.898265],[116.383337, 39.900070],[116.383337, 39.900070],[116.390871, 39.900280],[116.394938, 39.900165],[116.399090, 39.900101],[116.404512, 39.900718],[116.404512, 39.900718],[116.411508, 39.900953],[116.411542, 39.900985],[116.411692, 39.903087],[116.411508, 39.907638],[116.411508, 39.907638],[116.411577, 39.909786],[116.411283, 39.910271],[116.411663, 39.910370],[116.412577, 39.910487],[116.412577, 39.910487],[116.412843, 39.911023],[116.412843, 39.911086],[116.412829, 39.911071],[116.412892, 39.910869],[116.412892, 39.910869],[116.412872, 39.910636],[116.412862, 39.910686],[116.412872, 39.910703],[116.412913, 39.910686],[116.412913, 39.910686],[116.412958, 39.910783],[116.412942, 39.910853],[116.413092, 39.910783],[116.412973, 39.910720],[116.412973, 39.910720],[116.413026, 39.910686],[116.412958, 39.910587],[116.412913, 39.910621],[116.412913, 39.910803],[116.412913, 39.910803],[116.412958, 39.910783],[116.412862, 39.910803],[116.413042, 39.910783],[116.412993, 39.910770],[116.412993, 39.910770],[116.412973, 39.910753],[116.413026, 39.910753],[116.412993, 39.910833],[116.413112, 39.910783],[116.413112, 39.910783],[116.413073, 39.910819],[116.413223, 39.910803],[116.412993, 39.910803],[116.412993, 39.910833],[116.412993, 39.910833],[116.413012, 39.910753],[116.412958, 39.910703],[116.412993, 39.910537],[116.412927, 39.910419],[116.412927, 39.910419],[116.412828, 39.910453],[116.412973, 39.910537],[116.412942, 39.910653],[116.412927, 39.910720],[116.412927, 39.910720],[116.412773, 39.910438],[116.412913, 39.910369],[116.412773, 39.910453],[116.413073, 39.910770],[116.413073, 39.910770],[116.412927, 39.910603],[116.413012, 39.910636],[116.413073, 39.910670],[116.413143, 39.910670],[116.413143, 39.910670],[116.413073, 39.910503],[116.412872, 39.910419],[116.412913, 39.910453],[116.412942, 39.910553],[116.412942, 39.910553],[116.413012, 39.910636],[116.413073, 39.910686],[116.413112, 39.910636],[116.413026, 39.910783],[116.413026, 39.910783],[116.413223, 39.910537],[116.413242, 39.910303],[116.413252, 39.910203],[116.412913, 39.910720],[116.412913, 39.910720],[116.412958, 39.910853],[116.412927, 39.910937],[116.413012, 39.910636],[116.413073, 39.910770],[116.413073, 39.910770],[116.412892, 39.910735],[116.412813, 39.910720],[116.413057, 39.910573],[116.412843, 39.910653],[116.412843, 39.910653],[116.412253, 39.910553],[116.411478, 39.908321],[116.411463, 39.907803],[116.411706, 39.901420],[116.411706, 39.901420],[116.412042, 39.899318],[116.412321, 39.894588],[116.408551, 39.892903],[116.395967, 39.890799],[116.395967, 39.890799],[116.385658, 39.889625],[116.379291, 39.889351],[116.368924, 39.889356],[116.366500, 39.889352],[116.366500, 39.889352],[116.364326, 39.889231],[116.359221, 39.889406],[116.359096, 39.889306],[116.339257, 39.889870],[116.339423, 39.889855],[116.323306, 39.889839],[116.323056, 39.889804],[116.319808, 39.888967],[116.318225, 39.888296],[116.318225, 39.888296],[116.306440, 39.882959],[116.295852, 39.879893],[116.284207, 39.877614],[116.266253, 39.869749],[116.266253, 39.869749],[116.253973, 39.864063],[116.254323, 39.860813],[116.254589, 39.859680],[116.255423, 39.857962],[116.255423, 39.857962],[116.255322, 39.857892],[116.255322, 39.857862],[116.255322, 39.857829],[116.255362, 39.857829],[116.255362, 39.857829],[116.255137, 39.857745],[116.255123, 39.857762],[116.255172, 39.857779],[116.255203, 39.857779],[116.255203, 39.857779],[116.255273, 39.857745],[116.255292, 39.857862],[116.255273, 39.857844],[116.255263, 39.857912],[116.255263, 39.857912],[116.255222, 39.857879],[116.255263, 39.857879],[116.255263, 39.857879],[116.255237, 39.857844],[116.255237, 39.857844],[116.255263, 39.857844],[116.255263, 39.857844],[116.255292, 39.857829],[116.255362, 39.857844],[116.255362, 39.857844],[116.255362, 39.857892],[116.255362, 39.857862],[116.255402, 39.857829],[116.255372, 39.857829],[116.255372, 39.857829],[116.255302, 39.857779],[116.255333, 39.858096],[116.255687, 39.858478],[116.255573, 39.858696],[116.255573, 39.858696],[116.255602, 39.858713],[116.255588, 39.858746],[116.255602, 39.858713],[116.255583, 39.858685],[116.255583, 39.858685],[116.255023, 39.859763],[116.255023, 39.859763],[116.261072, 39.862381],[116.263505, 39.863569],[116.265563, 39.864550],[116.267774, 39.865966],[116.267833, 39.865969],[116.265659, 39.866198],[116.265659, 39.866198],[116.264524, 39.871615],[116.264538, 39.872000],[116.264524, 39.872115],[116.253355, 39.872231],[116.253339, 39.872231],[116.247328, 39.867181],[116.247348, 39.865828],[116.247262, 39.865731],[116.247351, 39.865738],[116.247351, 39.865738],[116.247448, 39.869248],[116.253096, 39.876080],[116.253096, 39.876080],[116.253026, 39.888793],[116.253026, 39.888793],[116.252987, 39.889483],[116.252988, 39.892930],[116.253028, 39.896547],[116.259107, 39.900265],[116.259177, 39.900265],[116.260035, 39.901903],[116.260027, 39.902515],[116.259978, 39.903582],[116.260014, 39.903569],[116.257912, 39.903815],[116.255509, 39.903799],[116.255509, 39.903799],[116.255528, 39.903780],[116.255464, 39.903749],[116.255478, 39.903765],[116.255509, 39.903835],[116.255509, 39.903835],[116.255528, 39.903765],[116.255593, 39.903799],[116.255509, 39.903835],[116.255528, 39.903780],[116.255528, 39.903780],[116.255548, 39.903749],[116.255548, 39.903681],[116.255548, 39.903799],[116.255579, 39.903749],[116.255579, 39.903749],[116.255608, 39.903915],[116.255628, 39.903849],[116.255649, 39.903898],[116.255608, 39.903883],[116.255608, 39.903883],[116.255509, 39.903933],[116.255579, 39.903865],[116.253145, 39.904065],[116.253146, 39.906765],[116.253146, 39.906765],[116.253108, 39.910516],[116.253067, 39.912202],[116.253051, 39.914266],[116.253081, 39.915801],[116.253081, 39.918231],[116.253247, 39.923445],[116.253182, 39.923400],[116.253182, 39.923400],[116.253220, 39.923522],[116.253220, 39.923522],[116.259550, 39.924048],[116.259530, 39.924016],[116.263930, 39.924017],[116.271818, 39.924137],[116.271818, 39.924137],[116.287345, 39.924242],[116.287345, 39.924242],[116.287345, 39.924242],[116.287311, 39.924035],[116.287380, 39.923985],[116.288281, 39.922569],[116.290681, 39.924039],[116.290821, 39.924039],[116.295623, 39.918661],[116.295272, 39.918728],[116.293995, 39.918862],[116.293975, 39.918943],[116.295286, 39.918660],[116.298131, 39.917581],[116.298131, 39.917581],[116.302137, 39.913520],[116.303554, 39.913072],[116.307447, 39.913013],[116.314370, 39.908157],[116.314370, 39.908157],[116.314039, 39.908740],[116.314129, 39.908826],[116.314019, 39.908774],[116.314410, 39.908741],[116.314640, 39.908643],[116.314640, 39.908643],[116.314325, 39.908489],[116.314239, 39.908440],[116.314129, 39.908508],[116.314129, 39.908508],[116.314169, 39.908039],[116.314199, 39.908157],[116.314259, 39.908157],[116.314259, 39.908157],[116.314259, 39.908157],[116.314239, 39.908157],[116.314239, 39.908124],[116.314290, 39.908142],[116.314225, 39.908207],[116.314225, 39.908207],[116.314129, 39.908256],[116.314159, 39.908241],[116.314139, 39.908241],[116.314129, 39.908291],[116.314129, 39.908291],[116.314139, 39.908274],[116.314159, 39.908256],[116.314139, 39.908241],[116.314129, 39.908256],[116.314129, 39.908256],[116.314129, 39.908256],[116.314269, 39.908207],[116.314139, 39.908241],[116.314060, 39.908329],[116.314060, 39.908329],[116.314139, 39.908256],[116.314129, 39.908256],[116.312285, 39.908688],[116.310483, 39.913518],[116.310463, 39.920018],[116.310334, 39.923086],[116.310334, 39.923086],[116.307619, 39.924446],[116.304302, 39.924075],[116.299714, 39.924034],[116.293905, 39.924093],[116.293905, 39.924093],[116.290030, 39.924070],[116.290115, 39.924138],[116.288448, 39.924166],[116.274014, 39.924307],[116.273834, 39.924306],[116.256761, 39.924583],[116.244628, 39.926850],[116.230854, 39.924727],[116.206268, 39.924773],[116.206268, 39.924773],[116.198981, 39.925070],[116.198771, 39.924771],[116.199495, 39.924467],[116.199495, 39.924467],[116.199495, 39.924467],[116.199470, 39.924470],[116.199470, 39.924503],[116.199470, 39.924503],[116.201032, 39.924534],[116.202013, 39.924548],[116.203210, 39.924530],[116.221370, 39.924653],[116.221370, 39.924653],[116.247455, 39.927152],[116.260480, 39.924182],[116.263185, 39.924176],[116.266332, 39.924180],[116.269612, 39.924170],[116.281890, 39.924179],[116.281890, 39.924179],[116.289549, 39.923907],[116.290540, 39.923923],[116.290566, 39.923957],[116.290692, 39.923929],[116.290692, 39.923929],[116.293821, 39.923993],[116.314712, 39.923876],[116.314712, 39.923876],[116.322098, 39.923589],[116.326708, 39.923431],[116.330517, 39.923172],[116.334586, 39.921363],[116.334586, 39.921363],[116.334520, 39.918642],[116.334566, 39.918277],[116.334550, 39.917747],[116.334519, 39.915680],[116.334519, 39.915680],[116.334735, 39.911144],[116.337906, 39.907418],[116.344888, 39.907264],[116.354459, 39.907115],[116.354459, 39.907115],[116.356222, 39.904682],[116.356352, 39.901602],[116.359157, 39.899023],[116.363225, 39.896113],[116.363245, 39.896013],[116.363405, 39.890664],[116.363405, 39.890664],[116.363412, 39.890561],[116.363465, 39.890447],[116.363494, 39.890263],[116.363525, 39.890013],[116.363534, 39.890049],[116.363534, 39.890049],[116.363534, 39.890049],[116.363525, 39.889813],[116.363525, 39.889813],[116.365498, 39.889031],[116.367767, 39.887401],[116.367331, 39.885204],[116.367861, 39.883433],[116.367130, 39.883452],[116.367130, 39.883452],[116.370827, 39.880924],[116.370785, 39.880200],[116.370764, 39.879261],[116.370119, 39.878490],[116.364961, 39.878131],[116.356779, 39.877934],[116.356779, 39.877934],[116.351722, 39.877595],[116.351735, 39.877595],[116.351735, 39.877595],[116.352400, 39.877709],[116.353707, 39.876996],[116.353823, 39.874896],[116.354173, 39.868296],[116.354173, 39.868296],[116.354923, 39.861580],[116.362458, 39.861925],[116.364602, 39.860078],[116.366681, 39.858702],[116.366681, 39.858702],[116.366790, 39.858705],[116.367477, 39.858682],[116.367508, 39.858682],[116.364763, 39.859296],[116.364523, 39.861613],[116.364477, 39.864179],[116.364470, 39.865092],[116.364443, 39.866386],[116.366347, 39.869266],[116.366347, 39.869266],[116.383423, 39.870668],[116.387812, 39.868526],[116.387197, 39.865408],[116.386426, 39.865741],[116.386426, 39.865741],[116.382621, 39.865622],[116.382621, 39.865622],[116.382621, 39.865622],[116.382621, 39.865622],[116.382621, 39.865622],[116.382708, 39.884199],[116.386418, 39.883388],[116.386418, 39.883388],[116.382621, 39.865622],[116.382621, 39.865622],[116.384294, 39.865723],[116.387898, 39.867275],[116.387898, 39.867275],[116.379068, 39.870663],[116.366918, 39.869667],[116.352319, 39.868611],[116.348844, 39.887454],[116.348844, 39.887622],[116.349597, 39.897973],[116.339965, 39.897603],[116.326364, 39.897196],[116.310420, 39.900601],[116.310420, 39.900734],[116.310233, 39.921533],[116.310424, 39.929052],[116.310365, 39.931600],[116.310495, 39.931969],[116.310495, 39.931969],[116.302871, 39.934690],[116.304364, 39.938009],[116.304444, 39.938379],[116.304249, 39.938673],[116.304249, 39.938673],[116.304249, 39.938673],[116.304725, 39.938492],[116.304705, 39.938509],[116.306028, 39.942027],[116.306278, 39.942344],[116.306178, 39.942352],[116.306238, 39.942412],[116.306287, 39.942450],[116.307310, 39.943064],[116.307431, 39.943029],[116.306592, 39.939494],[116.304815, 39.938543],[116.303106, 39.934992],[116.298313, 39.933614],[116.298163, 39.933584],[116.298714, 39.933818],[116.298794, 39.933833],[116.299265, 39.933819],[116.299265, 39.933834],[116.298984, 39.933704],[116.299265, 39.933883],[116.299234, 39.933834],[116.299265, 39.933801],[116.299194, 39.933649],[116.299194, 39.933649],[116.299752, 39.933869],[116.299796, 39.933869],[116.301884, 39.933140],[116.301739, 39.932788],[116.304844, 39.932274],[116.314583, 39.932276],[116.314944, 39.932291],[116.325367, 39.932329],[116.325397, 39.932365],[116.333154, 39.932226],[116.339247, 39.928206],[116.339528, 39.928192],[116.344690, 39.928117],[116.350753, 39.928128],[116.353379, 39.926332],[116.353008, 39.924130],[116.353008, 39.924130],[116.350191, 39.923576],[116.349584, 39.925074],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.349891, 39.925123],[116.342956, 39.928129],[116.334226, 39.928182],[116.334156, 39.928162],[116.321578, 39.928122],[116.316296, 39.928112],[116.310364, 39.929868],[116.308351, 39.932398],[116.308140, 39.932398],[116.298343, 39.932481],[116.297889, 39.933472],[116.297889, 39.933472],[116.297988, 39.933476],[116.298964, 39.933750],[116.300531, 39.933771],[116.301825, 39.933729],[116.302594, 39.934193],[116.305141, 39.939760],[116.305206, 39.939910],[116.311554, 39.941521],[116.310457, 39.945304],[116.317010, 39.945681],[116.324286, 39.946364],[116.324366, 39.946378],[116.324909, 39.946757],[116.324909, 39.946757],[116.324909, 39.946757],[116.323936, 39.952494],[116.323285, 39.956711],[116.322284, 39.963773],[116.321162, 39.967373],[116.321032, 39.967639],[116.318026, 39.975100],[116.317736, 39.975633],[116.311093, 39.980005],[116.311093, 39.980005],[116.308888, 39.982484],[116.307502, 39.982444],[116.307502, 39.982444],[116.307502, 39.982444],[116.307470, 39.982416],[116.306765, 39.982410],[116.306033, 39.982297],[116.306095, 39.982309],[116.309540, 39.980369],[116.309569, 39.980269],[116.312010, 39.980357],[116.312024, 39.980457],[116.312424, 39.979571],[116.312424, 39.979571],[116.312424, 39.979571],[116.312546, 39.979458],[116.317105, 39.977467],[116.317155, 39.977314],[116.322867, 39.976127],[116.327347, 39.976301],[116.333300, 39.976412],[116.338302, 39.973337],[116.341171, 39.972209],[116.341171, 39.972209],[116.341194, 39.972209],[116.340477, 39.972426],[116.339035, 39.972280],[116.338517, 39.972223],[116.338618, 39.972222],[116.338101, 39.973972],[116.336628, 39.973804],[116.336628, 39.973769],[116.334091, 39.970747],[116.333712, 39.977413],[116.333462, 39.982178],[116.333107, 39.987798],[116.333092, 39.988013],[116.332691, 39.994738],[116.332691, 39.994728],[116.332689, 39.994609],[116.332689, 39.994609],[116.332726, 39.994346],[116.333022, 39.989913],[116.333142, 39.986563],[116.333142, 39.986563],[116.344618, 39.986370],[116.356594, 39.986891],[116.370741, 39.987278],[116.381319, 39.976958],[116.381319, 39.976626],[116.379345, 39.954273],[116.378798, 39.950787],[116.382443, 39.948706],[116.405869, 39.948987],[116.406319, 39.948988],[116.432850, 39.948893],[116.433848, 39.939691],[116.434296, 39.929470],[116.435208, 39.913021],[116.435252, 39.912754],[116.434072, 39.901039],[116.428140, 39.900779],[116.428019, 39.900695],[116.428019, 39.900695],[116.428019, 39.900695],[116.427960, 39.900765],[116.427480, 39.897361],[116.427480, 39.897361],[116.427407, 39.897494],[116.430627, 39.897159],[116.430811, 39.896574],[116.431045, 39.893825],[116.428394, 39.893794],[116.418887, 39.894666],[116.418874, 39.894918],[116.418409, 39.903318],[116.418160, 39.907151],[116.417976, 39.909382],[116.413153, 39.910603],[116.413042, 39.910603],[116.411717, 39.910525],[116.411387, 39.910479],[116.411387, 39.910479],[116.411462, 39.904953],[116.411706, 39.901403],[116.411762, 39.900870],[116.412406, 39.893203],[116.412406, 39.893203],[116.412639, 39.888384],[116.419551, 39.886750],[116.423732, 39.883912],[116.433790, 39.884188],[116.433920, 39.884155],[116.434062, 39.882754],[116.434062, 39.882754],[116.434057, 39.882781],[116.434119, 39.881954],[116.434349, 39.880870],[116.439574, 39.872381],[116.439574, 39.872331],[116.439154, 39.871055],[116.438272, 39.870888],[116.429275, 39.871109],[116.419504, 39.871179],[116.406188, 39.872081],[116.385196, 39.871572],[116.385205, 39.871725],[116.386811, 39.863257],[116.386675, 39.861091],[116.386811, 39.860907],[116.386796, 39.860907],[116.386796, 39.860907],[116.386306, 39.860968],[116.386826, 39.860891],[116.386826, 39.860858],[116.386756, 39.860891],[116.386826, 39.860791],[116.386826, 39.860791],[116.386876, 39.860841],[116.386856, 39.860871],[116.387026, 39.860841],[116.386996, 39.860891],[116.386996, 39.860891],[116.387096, 39.860926],[116.387146, 39.860976],[116.387146, 39.861006],[116.387126, 39.861041],[116.387126, 39.861041],[116.387162, 39.861025],[116.387106, 39.861006],[116.387066, 39.861025],[116.387096, 39.860957],[116.387096, 39.860957],[116.387162, 39.860941],[116.387106, 39.860976],[116.387206, 39.860957],[116.387126, 39.861006],[116.387126, 39.861006],[116.387162, 39.860991],[116.387126, 39.860991],[116.386976, 39.860991],[116.386896, 39.860991],[116.386856, 39.860976],[116.387036, 39.860941],[116.387146, 39.860926],[116.387196, 39.860907],[116.387196, 39.860858],[116.387196, 39.860858],[116.387206, 39.860891],[116.387246, 39.860858],[116.387226, 39.860871],[116.387076, 39.860926],[116.387076, 39.860926],[116.387106, 39.860941],[116.387096, 39.860957],[116.387146, 39.860991],[116.387196, 39.860941],[116.387176, 39.860941]]
narrs = trajectory_compression(arrs, "0.0007", EUCLIDIAN_DISTANCE)
print(narrs)

